# Digital Image Processing Homework 2\
老舊照片修復

- **學號:** S11159005

- **姓名:** 黃毓峰

---

## 老舊照片修復 MATLAB GUI 應用程式說明文件

### 1\. 概觀 (Overview)

此 MATLAB 應用程式 (`imageProcessingAppLayout.m`) 提供了一個圖形使用者介面 (GUI)，用於輔助修復數位化的老舊照片。主要功能包括：

- **上傳影像:** 載入本地的影像檔案。

- **影像處理:**

   - 去除刮痕/噪點 (使用中值濾波)

   - 自動色彩平衡 (使用灰度世界假設)

   - 增強對比度 (使用自適應直方圖均衡)

   - 增強色彩飽和度

- **效果預覽:** 即時顯示原始影像與處理後影像的對比。

- **儲存結果:** 將處理後的影像儲存到原始檔案所在的目錄。

### 2\. 系統需求 (System Requirements)

為確保程式能正常運行，請確認您的環境符合以下要求：

- **作業系統:** macOS Sonoma 14.5 或更新版本 (經測試環境為 macOS 14.5)

- **MATLAB:** R2024a 或更新版本 (經測試環境為 R2024a)

   - **必要工具箱:** **Image Processing Toolbox** (此工具箱必須安裝，程式中使用了 `imread`, `imshow`, `medfilt2`, `adapthisteq`, `rgb2lab`, `lab2rgb`, `rgb2hsv`, `hsv2rgb`, `im2uint8` 等函數)。

### 3\. 安裝與設定 (Setup)

1. **取得程式碼:** 下載 `imageProcessingAppLayout.m` 檔案。

2. **確保環境:** 確認您的系統已安裝符合需求的 MATLAB 版本以及 **Image Processing Toolbox**。您可以透過在 MATLAB 命令視窗輸入 `ver` 來查看已安裝的工具箱列表。

3. **設定路徑:** 將 `imageProcessingAppLayout.m` 檔案放置在 MATLAB 的**目前資料夾 (Current Folder)** 或 MATLAB 路徑 (Path) 可存取的位置。

### 4\. 使用教學 (How to Use)

1. **啟動應用程式:**

   - 開啟 MATLAB。

   - 將 MATLAB 的「目前資料夾」切換到包含 `imageProcessingAppLayout.m` 的目錄。

   - 在 MATLAB 命令視窗 (Command Window) 中輸入 `imageProcessingAppLayout` 並按下 Enter 鍵執行。

   - 稍待片刻，應用程式的 GUI 視窗將會出現。

2. **上傳影像:**

   - 點擊視窗左上方「檔案操作」面板中的「**上傳影像**」按鈕。

   - 系統會開啟一個檔案選擇對話框。

   - 選擇您想要處理的影像檔案（支援常見格式如 JPG, JPEG, PNG, TIF, BMP 等）。

   - 選擇檔案後，原始影像將顯示在 GUI 左側的「原始影像」區域，同時視窗標題會更新顯示檔案名稱。

3. **選擇處理選項:**

   - 在視窗右上方「處理選項」面板中，勾選您想要應用的處理步驟。預設勾選了常用的選項。

   - 將滑鼠游標懸停在各個選項的文字上，可以查看該選項功能的簡要說明 (Tooltip)。

      - **1\. 去刮痕/噪點 (中值濾波):** 使用 3x3 中值濾波器。適用於去除椒鹽噪點或細小刮痕，但可能輕微模糊影像。(預設: **開啟**)

      - **2\. 色彩平衡 (自動校正):** 基於灰度世界假設調整色彩。(預設: **開啟**)

      - **3\. 增強對比度 (褪色):** 使用自適應直方圖均衡 (adapthisteq) 提高影像對比度，對改善褪色照片有幫助。(預設: **開啟**)

      - **4\. 增強色彩飽和度:** 提高彩色影像的鮮豔程度。(預設: **關閉**)

   - 您可以根據照片的具體情況，自由組合這些選項。

4. **執行處理:**

   - 選擇好處理選項後，點擊「處理選項」面板底部的「**處理影像**」按鈕。

   - 程式會根據您勾選的選項，依序對原始影像進行處理。處理過程的訊息（例如應用的步驟、耗時）會顯示在 MATLAB 命令視窗中。

   - 處理時間會根據影像大小和選擇的處理步驟數量而變化。

5. **預覽結果:**

   - 處理完成後，結果影像將顯示在 GUI 右側的「處理後影像」區域。

   - 該區域的標題會更新，顯示本次處理實際應用的步驟組合。

6. **儲存影像:**

   - 如果您對處理結果感到滿意，可以點擊左側「檔案操作」面板中的「**儲存處理後影像**」按鈕。

      - *注意:* 此按鈕只有在成功執行一次「處理影像」操作後才會啟用。

   - 點擊後，處理後的影像將會以 `output.<原始副檔名>` 的格式（例如，若原始檔是 `old_photo.jpg`，則儲存為 `output.jpg`）自動儲存到**原始影像所在的同一個資料夾**中。

   - 儲存成功後，會彈出一個提示訊息框告知儲存位置。

7. **處理下一張或關閉:**

   - 您可以重複步驟 2-6 來處理不同的影像。上傳新影像會清除之前的處理結果。

   - 完成操作後，直接點擊視窗右上角的關閉按鈕即可退出應用程式。

### 5\. 處理流程概述 (Processing Workflow)

當使用者點擊「處理影像」按鈕時，程式內部的基本處理流程如下：

1. **獲取選項:** 讀取介面上四個處理選項核取方塊的狀態（勾選/未勾選）。

2. **檢查輸入:** 確認至少選擇了一個處理選項，否則提示錯誤。

3. **循序處理:** 以原始影像為起點，按照固定的順序（1 -> 2 -> 3 -> 4）判斷對應選項是否被勾選，若勾選則執行相應的處理函數：

   - `applyScratchReduction`: 應用中值濾波。

   - `applyColorBalanceGrayworld`: 應用灰度世界色彩平衡（僅對彩色影像有效）。

   - `applyContrastEnhancementAdapthisteq`: 應用自適應直方圖均衡（彩色影像在 LAB 空間處理 L 通道，灰度影像直接處理）。

   - `applySaturationEnhancement`: 增強飽和度（僅對彩色影像有效，轉換至 HSV 空間處理 S 通道）。

   - 每一步的輸出作為下一步的輸入。

4. **更新顯示:** 將最終得到的 `processedImage` 顯示在右側的 Axes 元件中，並更新標題。

5. **啟用儲存:** 將「儲存處理後影像」按鈕的 `Enable` 屬性設為 `on`。

6. **紀錄資訊:** 在 MATLAB 命令視窗打印處理時間和應用的步驟。

### 6\. 注意事項 (Notes)

- **Image Processing Toolbox:** 重申，此工具箱是必需的。缺少它會導致程式出錯。

- **處理時間:** 高解析度的影像處理時間會相對較長。

- **色彩與灰度:** 色彩平衡和飽和度增強功能對灰度影像無效，程式會自動跳過這些步驟並在命令視窗給出提示。

- **檔案覆蓋:** 儲存功能會直接在原始目錄下建立名為 `output.<副檔名>` 的檔案。如果該檔案已存在，它將被**覆蓋**而不會事先詢問。